# 변이형 오토인코더를 사용한 이미지 생성
> 기존 이미지를 변형하여 새로운 이미지를 생성하는 기법으로 __변이형 오토인코더(VAE)와 적대적 생성 네트워크(GAN)__ 이 있다.

## 이미지 잠재 공간에서 샘플링
이미지 생성시 핵심은 실제 이미지로 매핑 될 수 있는 __벡터__ 의 표현을 만드는 것이다.
> 잠재 공간의 포인트를 이미지로 출력하는 모듈을 __생성자(GAN) 또는 디코더(VAE)__ 라고 한다.   

GAN과 VAE는 각각의 특징을 가진다
* __VAE__ : 구조적인 잠재 공간을 학습하는데 뛰어나며 이 공간에서 특정 방향은 데이터에서 의미있는 변화의 방향을 인코딩한다.
* __GAN__ : 실제 같은 이미지를 만드며 잠재 공간이 구조적이거나 연속성이 없을 수 있다.   

## 이미지 변형을 위한 개념 벡터
> 잠재 공간 & 임베딩 공간이 주어지면 공간의 방향은 원본 데이터의 흥미로운 변화를 인코딩한 축일 수 있다.   
예로, 잠재 공간 X가 어떤 얼굴의 임베딩 표현이고, X+Y가 같은 얼굴이 웃고 있는 표현 임베딩이라면, __이런 이미지를 잠재 공간에 투영해서 의미 있는 방향으로 이 을 이동 후 이미지 공간으로 디코딩하여 변형된 이미지를 얻을 수 있다.__   

## 변이형 오토인코더
> 오토인코더는 __입력을 저차원 잠재 공간으로 인코딩 후 디코딩하여 복원하는 네트워크__ 이다.   
> 변이형 오토인코더는 오토인코더의 최신 버전이다.   

원래 오토인코더는 입력을 압축 표현으로 매핑하고 이를 디코딩하는게 전부이지만 VAE는 __이미지를 통계 분포의 파라미터로 변환한다.__ (이미지가 통계적 과정을 통해 생성되었다고 가정하여 인코딩 & 디코딩동안 무작위성이 필요하다는 것을 의미)   
VAE는 잠재 공간에서 무작위로 샘플을 추출후 디코딩하여 복원한다.   
이런 무작위 과정에서 안정성을 향상하고 잠재 공간 어디든 의미있는 표현을 인코딩한다  

#### __VAE의 기술적 작동 순서__
#### 1. 인코더 모듈이 입력 이미지를 잠재 공간의 두 파라미터 A, B로 변환
#### 2. 잠재 공간의 정규 분포에서 무작위로 샘플링 한다.
#### 3. 디코더 모듈이 이 포인트를 원본 이미지로 매핑하여 복원한다.  

VAE는 __재구성 손실(디코딩된 샘플이 원본과 동일하도록 만듦)__ 과 __규제손실(잠재 공간 형성과 훈련 데이터의 과대적합 줄임)__ 의 2개 손실 함수로 훈련한다.  

#### __케라스의 VAE 구현__
```
# 입력을 평균과 분산 파라미터로 인코딩
z_mean, z_log_var = encoder(input_img)

# 무작위로 선택한 작은 epsilon 값을 사용하여 잠재 공간의 포인트를 뽑는다.
z = z_mean + exp(0.5 & z_log_var) * epsilon

# z를 이미지로 디코딩
reconstructed_img = decoder(z)

# 입력 이미지와 재구성 이미지를 매핑한 오토인코더 모델 객체 생성
model = Model(input_img, reconstructed_img)

# 그후 모델을 재구성 손실과 규제 손실로 훈련한다
```

## 정리
* 딥러닝으로 이미지에 대한 통계 정보를 담은 잠재 공간을 학습해 이미지를 생성할 수 있다.
* __VAE__ : 구조적 & 연속적인 잠재 공간의 표현을 만든다.
* __GAN__ : 실제 같은 단일 이미지를 생성 할 수 있지만 구조적 & 연속적인 잠재 공간은 못 만든다.